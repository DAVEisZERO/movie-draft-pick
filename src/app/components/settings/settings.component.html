<ion-header>
  <ion-toolbar>
    <ion-title color="primary">Account settings</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="dismissModal()" shape="round" fill="clear" color="danger">
        <ion-icon name="close" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content>
    <ion-grid class="ion-padding-start ion-padding-end">
        <ion-row>
        <ion-col size="12" size-md="5">
            <p>Name</p>
            <ion-note>
            <p>
                The name of your account. Your avatar is randomly generated based on
                this name.
            </p>
            @if (isEditingName()) {
            <ion-text color="primary">
                <p>
                You can also change your name by clicking on it next to your
                avatar in the side pane.
                </p>
            </ion-text>
            }
            </ion-note>
        </ion-col>
        <ion-col size="12" size-md="7" class="ion-margin-vertical">
            <form [formGroup]="changeNameForm" class="col-align-end">
            <ion-input
                (keyup.enter)="changeDisplayName()"
                [value]="user().name"
                errorText="Must START with an Uppercase letter Followed by letters, spaces, hyphens, or apostrophes"
                fill="outline"
                enterkeyhint="done"
                inputmode="text"
                type="text"
                formControlName="name"
            ></ion-input>
            <div class="button-wrapper ion-margin-top">
                @if (isEditingName()) {
                <ion-button
                (click)="changeDisplayName()"
                [disabled]="
                    changeNameForm.invalid || nameDidNotChange() || isNameLoading()
                "
                >
                @if (isNameLoading()) {
                <ion-spinner></ion-spinner>
                } @else { Change name }
                </ion-button>
                <ion-button
                (click)="isEditingName.set(false)"
                [disabled]="isNameLoading()"
                color="danger"
                >Cancel</ion-button
                >
                } @else {
                <ion-button (click)="isEditingName.set(true)"
                >Change name</ion-button
                >
                }
            </div>
            </form>
        </ion-col>
        </ion-row>
        <ion-row class="row-border-top ion-margin-top">
        <ion-col size="12" size-md="5">
            <p>Password</p>
            <ion-note>
            @if (isEditingPassword()) {
            <ion-text color="primary">
                <p>
                You will receive a confirmation code by email to confirm the
                change.
                </p>
            </ion-text>
            }
            </ion-note>
        </ion-col>
        <ion-col size="12" size-md="7" class="ion-margin-vertical">
            @if (isEditingPassword()) {
            <form [formGroup]="changePasswordForm" class="col-align-end">
            <ion-input
                [type]="showPassword() ? 'text' : 'password'"
                errorText="Must be at least 8 characters long, contain at least 1 Uppercase, 1 Lowercase, 1 Number, and 1 Special Character."
                fill="outline"
                label="New password"
                labelPlacement="stacked"
                enterkeyhint="next"
                inputmode="text"
                formControlName="password"
            >
                <ion-button
                (click)="toggleShowPassword('password')"
                tabindex="-1"
                slot="end"
                fill="clear"
                shape="round"
                >
                <ion-icon
                    [name]="showPassword() ? 'eye-off-outline' : 'eye-outline'"
                    slot="icon-only"
                ></ion-icon>
                </ion-button>
            </ion-input>
            <ion-input
                class="ion-margin-top"
                (keyup.enter)="sendPasswordChange()"
                [type]="showConfirmation() ? 'text' : 'password'"
                errorText="Must match your password"
                fill="outline"
                label="Confirm password"
                labelPlacement="stacked"
                enterkeyhint="done"
                inputmode="text"
                formControlName="confirmation"
            >
                <ion-button
                (click)="toggleShowPassword('confirmation')"
                tabindex="-1"
                slot="end"
                fill="clear"
                shape="round"
                >
                <ion-icon
                    [name]="showConfirmation() ? 'eye-off-outline' : 'eye-outline'"
                    slot="icon-only"
                ></ion-icon>
                </ion-button>
            </ion-input>
            </form>
            }
            <div class="button-wrapper ion-margin-top">
            @if (isEditingPassword()) {
            <ion-button
                (click)="sendPasswordChange()"
                [disabled]="changePasswordForm.invalid || isPasswordLoading()"
            >
                @if (isPasswordLoading()) {
                <ion-spinner></ion-spinner>
                } @else { Change password }
            </ion-button>
            <ion-button
                (click)="isEditingPassword.set(false)"
                [disabled]="isPasswordLoading()"
                color="danger"
                >Cancel</ion-button
            >
            } @else {
            <ion-button (click)="isEditingPassword.set(true)"
                >Change password</ion-button
            >
            }
            </div>
        </ion-col>
        </ion-row>
        <ion-row class="row-border-top ion-margin-top">
        <ion-col size="12" size-md="5">
            <p>Sign-Out</p>
            <ion-note>
            <p>Sign-Out of your current session.</p>
            </ion-note>
        </ion-col>
        <ion-col size="12" size-md="7" class="ion-margin-vertical">

            <div class="button-wrapper ion-margin-top">

            <ion-button (click)="logOut()" color="danger"
                >Sign-Out</ion-button
            >
            
            </div>
        </ion-col>
        </ion-row>
        <ion-row class="row-border-top ion-margin-top">
        <ion-col size="12" size-md="5">
            <p>Remove Account</p>
            <ion-note>
            <p>If you want to change email or delete permanently yotu data.</p>
            </ion-note>
        </ion-col>
        <ion-col size="12" size-md="7" class="ion-margin-vertical">

            <div class="button-wrapper ion-margin-top">

            <ion-button (click)="removeAccount()" color="danger"
                >Remove</ion-button
            >
            
            </div>
        </ion-col>
        </ion-row>
    </ion-grid>
</ion-content>
<ion-alert
  (didDismiss)="this.alertData.set({
    open: false,
    message: '',
    header: '',
  })"
  [isOpen]="alertData().open"
  [buttons]="ALERT_BUTTONS"
  [message]="alertData().message"
  backdropDismiss="false"
  [header]="alertData().header"
></ion-alert>
